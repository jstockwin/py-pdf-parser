name: Continuous Integration
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build the tests container using cache
        uses: whoan/docker-build-with-cache-action@tag-image-as-a-separate-step
        with:
          username: "${{ secrets.DOCKER_USERNAME }}"
          password: "${{ secrets.DOCKER_PASSWORD }}"
          image_name: billmonitor/py-pdf-parser-test
          image_tag: test
          dockerfile: dockerfiles/Dockerfile_tests
          push_image_and_stages: false
      - name: Run linting
        run: docker run --rm billmonitor/py-pdf-parser-test:test .github/scripts/lint.sh
      - name: Run test
        run: docker run --rm billmonitor/py-pdf-parser-test:test .github/scripts/test.sh
